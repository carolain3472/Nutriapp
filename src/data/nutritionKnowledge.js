// Base de conocimientos nutricionales ampliada y mejorada
export const nutritionKnowledge = {
    // Respuestas por categor√≠as principales
    greetings: [
      "¬°Hey! Soy tu asistente nutricional personal. ¬øEn qu√© te puedo echar una mano hoy? Puedo ayudarte con planes de comida, recetas, dudas sobre nutrici√≥n o lo que necesites.",
      "¬°Hola! Me da mucho gusto verte por aqu√≠. Estoy listo para ayudarte con todo lo relacionado a nutrici√≥n y alimentaci√≥n saludable. ¬øQu√© tienes en mente?",
      "¬°Qu√© tal! Soy tu compa√±ero nutricional. Ya sea que quieras mejorar tu alimentaci√≥n, aprender sobre nutrici√≥n o necesites ideas para comidas, aqu√≠ estoy para apoyarte.",
      "¬°Hola! Perfecto timing para hablar de nutrici√≥n. ¬øHay algo espec√≠fico que te tiene pensando sobre tu alimentaci√≥n hoy?"
    ],
  
    // Respuestas emp√°ticas para diferentes estados emocionales
    emotional: {
      frustrated: [
        "Oye, entiendo perfectamente esa frustraci√≥n. La nutrici√≥n puede ser confusa con tanta informaci√≥n contradictoria por ah√≠. Vamos paso a paso, sin presi√≥n. ¬øQu√© es lo que m√°s te est√° costando trabajo en este momento?",
        "S√© que puede ser s√∫per frustrante cuando sientes que est√°s haciendo todo 'bien' pero no ves resultados. Cada cuerpo es diferente y tiene sus propios tiempos. ¬øMe cuentas qu√© has estado intentando?",
        "La frustraci√≥n es totalmente normal en este proceso. A veces necesitamos ajustar la estrategia, no abandonarla. ¬øQu√© tal si revisamos juntos qu√© est√° pasando?"
      ],
      motivated: [
        "¬°Me encanta esa energ√≠a! Cuando tienes esa motivaci√≥n es el momento perfecto para establecer h√°bitos que realmente perduren. ¬øCu√°l es tu objetivo principal?",
        "¬°Eso es lo que me gusta escuchar! Aprovechemos esa motivaci√≥n para crear un plan que sea sostenible y que realmente disfrutes. ¬øPor d√≥nde quieres empezar?",
        "¬°Qu√© buena actitud! Es genial cuando decides priorizar tu salud. Vamos a canalizar esa energ√≠a hacia cambios que puedas mantener a largo plazo."
      ],
      confused: [
        "Tranquilo, es s√∫per normal sentirse abrumado con tanta informaci√≥n nutricional. Vamos a simplificar las cosas y empezar por lo b√°sico. ¬øQu√© es lo que m√°s te confunde?",
        "No te preocupes, todos hemos estado ah√≠. La nutrici√≥n no tiene que ser complicada. Te voy a explicar todo de manera sencilla. ¬øSobre qu√© tema espec√≠fico tienes dudas?",
        "Entiendo esa confusi√≥n, hay mucha informaci√≥n contradictoria. Vamos a aclarar las cosas de una vez por todas. ¬øCu√°l es tu duda principal?"
      ],
      anxious: [
        "Respira hondo. La ansiedad alrededor de la comida es m√°s com√∫n de lo que piensas. No hay alimentos 'prohibidos' ni decisiones perfectas. ¬øQu√© es lo que m√°s te preocupa?",
        "Hey, todo va a estar bien. La alimentaci√≥n saludable no tiene que generar estr√©s. Vamos a encontrar un enfoque que te haga sentir tranquilo y en control.",
        "Entiendo esa ansiedad. A veces la presi√≥n de comer 'perfecto' puede ser abrumadora. Vamos a trabajar en un enfoque m√°s relajado y sostenible."
      ]
    },
  
    // Respuestas expandidas para p√©rdida de peso
    weightLoss: {
      general: [
        "Para perder peso de manera inteligente y sostenible, lo clave es crear un d√©ficit cal√≥rico moderado sin morir de hambre. Te recomiendo:\n\n‚Ä¢ D√©ficit de 300-500 calor√≠as diarias (nada extremo)\n‚Ä¢ Prote√≠na en cada comida para mantener m√∫sculo\n‚Ä¢ Muchas verduras para saciedad\n‚Ä¢ Carbohidratos complejos para energ√≠a\n‚Ä¢ Hidrataci√≥n constante\n\n¬øCu√°l dir√≠as que es tu mayor desaf√≠o al intentar perder peso?",
        "La p√©rdida de peso que realmente funciona a largo plazo no es sobre restricci√≥n extrema, sino sobre crear h√°bitos que puedas mantener. Algunos tips que funcionan:\n\n‚Ä¢ Come despacio y escucha a tu cuerpo\n‚Ä¢ Llena la mitad del plato con verduras\n‚Ä¢ Include prote√≠na en cada comida\n‚Ä¢ Mant√©n horarios regulares\n‚Ä¢ Duerme bien (s√∫per importante)\n\n¬øHas intentado alguna dieta antes? ¬øQu√© tal te fue?"
      ],
      plateaus: [
        "Los estancamientos son s√∫per normales y frustrantes, pero tienen soluci√≥n. Tu cuerpo se adapta, as√≠ que necesitamos 'confundirlo' un poco:\n\n‚Ä¢ Var√≠a tu rutina de ejercicio\n‚Ä¢ Ajusta ligeramente las calor√≠as\n‚Ä¢ Revisa si est√°s durmiendo bien\n‚Ä¢ Considera hacer una semana de mantenimiento\n‚Ä¢ Mide progreso m√°s all√° de la b√°scula\n\n¬øHace cu√°nto que no ves cambios en el peso?",
        "Los plateaus son la forma en que tu cuerpo dice 'necesito un descanso'. No significa que est√©s haciendo algo mal:\n\n‚Ä¢ Tu metabolismo puede necesitar un reset\n‚Ä¢ Tal vez est√°s ganando m√∫sculo mientras pierdes grasa\n‚Ä¢ El estr√©s y el sue√±o influyen much√≠simo\n‚Ä¢ A veces necesitas comer un poco m√°s, no menos\n\n¬øC√≥mo te sientes de energ√≠a? ¬øHas notado cambios en c√≥mo te queda la ropa?"
      ],
      emotional: [
        "La comida emocional es s√∫per com√∫n y entendible. Todos comemos por emociones a veces. Lo importante es desarrollar otras estrategias:\n\n‚Ä¢ Identifica qu√© emociones te llevan a comer\n‚Ä¢ Ten alternativas listas (caminar, llamar a alguien, etc.)\n‚Ä¢ No te culpes cuando pase, aprende de la situaci√≥n\n‚Ä¢ Busca el patr√≥n para prevenirlo\n\n¬øHas notado qu√© situaciones o emociones te llevan m√°s a comer?"
      ]
    },
  
    // Respuestas expandidas para ganar masa muscular
    muscleGain: {
      general: [
        "Para ganar m√∫sculo de manera efectiva necesitas tres pilares fundamentales:\n\n‚Ä¢ Super√°vit cal√≥rico moderado (300-500 kcal extra)\n‚Ä¢ Prote√≠na suficiente: 1.6-2.2g por kg de peso\n‚Ä¢ Entrenamiento de fuerza consistente\n‚Ä¢ Descanso adecuado para recuperaci√≥n\n\n¬øCu√°l es tu peso actual para calcular tus necesidades exactas?",
        "El crecimiento muscular es un proceso que requiere paciencia y consistencia. Lo bueno es que funciona si haces las cosas bien:\n\n‚Ä¢ Come en super√°vit, pero no te pases\n‚Ä¢ Distribuye la prote√≠na a lo largo del d√≠a\n‚Ä¢ Entrena cada grupo muscular 2-3 veces por semana\n‚Ä¢ Duerme 7-9 horas para recuperaci√≥n\n\n¬øEst√°s entrenando con pesas actualmente?"
      ],
      hardgainer: [
        "Si te cuesta ganar peso, probablemente tienes un metabolismo r√°pido. Algunos tips espec√≠ficos:\n\n‚Ä¢ Come m√°s frecuentemente (5-6 comidas)\n‚Ä¢ Incluye m√°s grasas saludables (m√°s calor√≠as por gramo)\n‚Ä¢ Batidos de prote√≠na con avena y mantequilla de man√≠\n‚Ä¢ No llenes tanto con agua antes de comer\n‚Ä¢ Prioriza alimentos densos en calor√≠as\n\n¬øCu√°ntas comidas haces al d√≠a actualmente?",
        "Para los 'hard gainers' el secreto est√° en maximizar cada comida:\n\n‚Ä¢ Desayunos abundantes (avena con frutos secos)\n‚Ä¢ Snacks cal√≥ricos entre comidas\n‚Ä¢ Cenas consistentes aunque no tengas hambre\n‚Ä¢ Batidos post-entreno con carbos y prote√≠na\n‚Ä¢ Paciencia, porque vas a ganar m√∫sculo de calidad\n\n¬øTe cuesta trabajo sentir hambre o simplemente te llenas r√°pido?"
      ]
    },
  
    // Recetas organizadas por momento del d√≠a y objetivo
    recipes: {
      breakfast: {
        quick: [
          "**Smoothie Proteico Express** (5 min)\n\n‚Ä¢ 1 pl√°tano maduro\n‚Ä¢ 1 scoop de prote√≠na (vainilla)\n‚Ä¢ 1 taza de leche de almendras\n‚Ä¢ 1 cda de mantequilla de man√≠\n‚Ä¢ Hielo\n\nLic√∫a todo y listo. Perfecto para prisa.\n~400 kcal, 30g prote√≠na",
          "**Avena Overnight Deluxe** (prep la noche anterior)\n\n‚Ä¢ 1/2 taza de avena\n‚Ä¢ 1 taza de leche\n‚Ä¢ 1 cda de ch√≠a\n‚Ä¢ 1 cda de miel\n‚Ä¢ Frutos del bosque\n\nMezcla todo antes de dormir. Por la ma√±ana solo a√±ade fruta fresca.\n~350 kcal, 15g prote√≠na"
        ],
        hearty: [
          "**Tortilla de Espinacas y Queso** (15 min)\n\n‚Ä¢ 3 huevos enteros\n‚Ä¢ 2 tazas de espinacas baby\n‚Ä¢ 1/4 taza de queso feta\n‚Ä¢ 1 rebanada de pan integral\n‚Ä¢ Aceite de oliva\n\nSaltea espinacas, a√±ade huevos batidos, queso al final.\n~450 kcal, 32g prote√≠na",
          "**Bowl de Yogur Griego Power** (10 min)\n\n‚Ä¢ 1 taza de yogur griego natural\n‚Ä¢ 1/3 taza de granola casera\n‚Ä¢ 1 cda de miel\n‚Ä¢ Frutos secos mixtos\n‚Ä¢ Fruta de temporada\n\nUn desayuno que te mantiene lleno por horas.\n~380 kcal, 25g prote√≠na"
        ]
      },
      lunch: {
        office: [
          "**Ensalada de Pollo Mediterr√°nea** (prep dominical)\n\n‚Ä¢ Pechuga de pollo grillada\n‚Ä¢ Mix de hojas verdes\n‚Ä¢ Tomates cherry, pepino\n‚Ä¢ Aceitunas y queso feta\n‚Ä¢ Vinagreta de lim√≥n\n\nPrepara todo el domingo y tienes lunch para toda la semana.\n~420 kcal, 35g prote√≠na",
          "**Bowl de Quinoa y Salm√≥n** (20 min)\n\n‚Ä¢ 1 taza de quinoa cocida\n‚Ä¢ 120g de salm√≥n a la plancha\n‚Ä¢ Aguacate en cubos\n‚Ä¢ Edamames\n‚Ä¢ Aderezo de tahini\n\nComida completa que te da energ√≠a para toda la tarde.\n~480 kcal, 32g prote√≠na"
        ],
        home: [
          "**Pasta Integral con Pesto de Espinacas** (25 min)\n\n‚Ä¢ 80g pasta integral\n‚Ä¢ 2 tazas espinacas frescas\n‚Ä¢ 1/4 taza de nueces\n‚Ä¢ Ajo y aceite de oliva\n‚Ä¢ Queso parmesano\n\nLic√∫a espinacas, nueces, ajo y aceite. Mezcla con pasta.\n~450 kcal, 18g prote√≠na"
        ]
      },
      dinner: {
        light: [
          "**Sopa de Lentejas con Verduras** (30 min)\n\n‚Ä¢ 1 taza de lentejas rojas\n‚Ä¢ Apio, zanahoria, cebolla\n‚Ä¢ Caldo de verduras\n‚Ä¢ Especias al gusto\n‚Ä¢ Un toque de lim√≥n\n\nComfort food saludable que no te deja pesado.\n~320 kcal, 18g prote√≠na",
          "**Pescado al Horno con Verduras** (25 min)\n\n‚Ä¢ Filete de pescado blanco\n‚Ä¢ Calabac√≠n, pimientos, cebolla\n‚Ä¢ Aceite de oliva y hierbas\n‚Ä¢ Lim√≥n\n\nTodo al horno en una bandeja. F√°cil y nutritivo.\n~280 kcal, 28g prote√≠na"
        ],
        satisfying: [
          "**Tacos de Pollo con Aguacate** (20 min)\n\n‚Ä¢ Pechuga de pollo desmenuzada\n‚Ä¢ Tortillas de ma√≠z\n‚Ä¢ Aguacate, tomate, cebolla\n‚Ä¢ Salsa verde casera\n‚Ä¢ Yogur griego como crema\n\nComida mexicana saludable que satisface antojos.\n~380 kcal, 30g prote√≠na"
        ]
      },
      snacks: {
        sweet: [
          "**Energy Balls Caseras** (15 min prep)\n\n‚Ä¢ 1 taza de d√°tiles sin hueso\n‚Ä¢ 1/2 taza de almendras\n‚Ä¢ 2 cdas de cacao\n‚Ä¢ 1 cda de mantequilla de almendras\n\nProcesa todo, forma bolitas, refrigera.\n~80 kcal por bolita",
          "**Yogur con Granola Casera**\n\n‚Ä¢ 3/4 taza yogur griego\n‚Ä¢ 2 cdas granola sin az√∫car\n‚Ä¢ Frutos rojos\n‚Ä¢ Un toque de miel\n\nDulce saludable que calma antojos.\n~180 kcal, 15g prote√≠na"
        ],
        savory: [
          "**Hummus con Verduras**\n\n‚Ä¢ 1/3 taza de hummus casero\n‚Ä¢ Palitos de zanahoria, apio, pepino\n‚Ä¢ Tomates cherry\n\nSnack que te llena y nutre.\n~120 kcal, 6g prote√≠na",
          "**Tostada de Aguacate Deluxe**\n\n‚Ä¢ 1 rebanada pan integral\n‚Ä¢ 1/2 aguacate maduro\n‚Ä¢ Tomate cherry\n‚Ä¢ Semillas de hemp\n‚Ä¢ Sal y lim√≥n\n\nCl√°sico que nunca falla.\n~220 kcal, 8g prote√≠na"
        ]
      }
    },
  
    // Informaci√≥n sobre horarios y timing
    mealTiming: {
      general: [
        "El timing de las comidas puede marcar diferencia, aunque no es lo m√°s importante:\n\n‚Ä¢ Desayuno: Dentro de 2 horas de despertar\n‚Ä¢ Comidas cada 3-4 horas aproximadamente\n‚Ä¢ Cena: 2-3 horas antes de dormir\n‚Ä¢ Post-entreno: Prote√≠na + carbos dentro de 2 horas\n\n¬øTienes horarios muy irregulares o bastante fijos?",
        "Los horarios ideales dependen mucho de tu rutina personal:\n\n‚Ä¢ Lo m√°s importante es la consistencia\n‚Ä¢ Escucha las se√±ales de hambre de tu cuerpo\n‚Ä¢ Si entrenas, el timing post-workout s√≠ importa\n‚Ä¢ No te obsesiones con horarios exactos\n\n¬øCu√°l es tu horario t√≠pico de comidas actualmente?"
      ],
      workSchedule: [
        "Para horarios de oficina est√°ndar te recomiendo:\n\n‚Ä¢ 7-8am: Desayuno consistente\n‚Ä¢ 10-11am: Snack si es necesario\n‚Ä¢ 12-2pm: Almuerzo principal\n‚Ä¢ 4-5pm: Snack/merienda\n‚Ä¢ 7-8pm: Cena\n\n¬øTu trabajo te permite comer a horarios regulares?",
        "Si trabajas turnos irregulares:\n\n‚Ä¢ Mant√©n al menos 3 comidas principales\n‚Ä¢ Ten snacks saludables siempre a mano\n‚Ä¢ Hidrataci√≥n constante es clave\n‚Ä¢ Trata de comer algo cada 4-5 horas m√°ximo\n\n¬øQu√© tipo de horario manejas en tu trabajo?"
      ]
    },
  
    // Informaci√≥n sobre intolerancias y alergias
    intolerances: {
      lactose: [
        "La intolerancia a la lactosa no significa eliminar todo l√°cteo:\n\n‚Ä¢ Yogur griego y quesos maduros suelen tolerarse mejor\n‚Ä¢ Leches vegetales fortificadas (almendra, avena)\n‚Ä¢ Lactasa en pastillas si quieres comer l√°cteos ocasionalmente\n‚Ä¢ Muchos alimentos ricos en calcio sin lactosa\n\n¬øQu√© tan severa es tu intolerancia? ¬øPuedes tolerar peque√±as cantidades?",
        "Alternativas ricas en calcio sin lactosa:\n\n‚Ä¢ Almendras y tahini\n‚Ä¢ Verduras de hoja verde oscura\n‚Ä¢ Sardinas con hueso\n‚Ä¢ Leches vegetales fortificadas\n‚Ä¢ Tofu hecho con sulfato de calcio\n\n¬øTe preocupa especialmente alg√∫n nutriente al evitar l√°cteos?"
      ],
      gluten: [
        "Vivir sin gluten es totalmente manejable hoy en d√≠a:\n\n‚Ä¢ C√©ntrate en alimentos naturalmente sin gluten\n‚Ä¢ Quinoa, arroz, avena certificada sin gluten\n‚Ä¢ Lee etiquetas siempre (se esconde en muchos productos)\n‚Ä¢ Evita contaminaci√≥n cruzada si eres cel√≠aco\n\n¬øEs por celiaqu√≠a o sensibilidad al gluten?",
        "Granos y cereales seguros sin gluten:\n\n‚Ä¢ Quinoa (s√∫per vers√°til)\n‚Ä¢ Arroz en todas sus variedades\n‚Ä¢ Avena certificada sin gluten\n‚Ä¢ Amaranto y mijo\n‚Ä¢ Trigo sarraceno\n\n¬øHay alg√∫n grano espec√≠fico que te guste m√°s o quieras probar?"
      ]
    },
  
    // Respuestas sobre hidrataci√≥n expandidas
    hydration: {
      general: [
        "La hidrataci√≥n va mucho m√°s all√° de solo 'tomar 8 vasos':\n\n‚Ä¢ Tu peso en kg x 35ml = necesidad base\n‚Ä¢ M√°s si haces ejercicio o hace calor\n‚Ä¢ El color de tu orina es el mejor indicador\n‚Ä¢ Frutas y verduras tambi√©n cuentan\n‚Ä¢ Infusiones sin az√∫car son perfectas\n\n¬øTe cuesta trabajo tomar suficiente agua durante el d√≠a?",
        "Tips para hidratarte mejor sin aburrirte:\n\n‚Ä¢ Agua con rodajas de pepino o lim√≥n\n‚Ä¢ T√©s de hierbas fr√≠os\n‚Ä¢ Agua con gas y un splash de jugo natural\n‚Ä¢ Botella con marcas horarias\n‚Ä¢ Apps recordatorias si eres olvidadizo\n\n¬øCu√°l dir√≠as que es tu mayor obst√°culo para hidratarte bien?"
      ],
      exercise: [
        "Para hidrataci√≥n durante ejercicio:\n\n‚Ä¢ Antes: 500ml, 2 horas antes\n‚Ä¢ Durante: 150-250ml cada 15-20 min\n‚Ä¢ Despu√©s: 150% del peso perdido en sudor\n‚Ä¢ Electrolitos si ejercicio > 1 hora\n\n¬øQu√© tipo de ejercicio haces y por cu√°nto tiempo?"
      ]
    },
  
    // Manejo de respuestas incoherentes o sin sentido
    fallback: [
      "Hmm, no estoy seguro de haber entendido bien tu pregunta. ¬øPodr√≠as reformularla? Estoy aqu√≠ para ayudarte con todo lo relacionado a nutrici√≥n y alimentaci√≥n saludable.",
      "Creo que hubo algo confuso en tu mensaje. ¬øTe refieres a algo espec√≠fico sobre nutrici√≥n, recetas, o h√°bitos alimenticios? Me encanta ayudar, solo necesito entender mejor qu√© buscas.",
      "No logr√© captar exactamente qu√© necesitas. ¬øEst√°s preguntando sobre alg√∫n alimento en particular, recetas, planes de alimentaci√≥n, o alg√∫n tema nutricional espec√≠fico?",
      "Parece que tu mensaje se cort√≥ o hubo alg√∫n error. Sin problema, vuelve a escribirme lo que necesitas saber sobre nutrici√≥n y con gusto te ayudo."
    ],
  
    // Respuestas motivacionales
    motivation: [
      "Los cambios reales toman tiempo, pero cada decisi√≥n saludable cuenta. No se trata de perfecci√≥n, sino de progreso constante. ¬øQu√© peque√±o cambio podr√≠as hacer hoy?",
      "Recuerda que est√°s invirtiendo en tu salud a largo plazo. Cada comida nutritiva es un paso hacia la versi√≥n m√°s saludable de ti mismo. ¬°Vas por buen camino!",
      "No subestimes el poder de los h√°bitos peque√±os y consistentes. No necesitas una transformaci√≥n radical overnight. ¬øCu√°l ser√≠a un cambio peque√±o que podr√≠as mantener por una semana?",
      "Tu cuerpo es incre√≠blemente inteligente y adaptable. Dale tiempo, nutrientes de calidad y movimiento, y ver√°s resultados. La paciencia es tu mejor aliada en este proceso."
    ],
  
    // Respuestas sobre ejercicio y nutrici√≥n
    exercise: [
      "La nutrici√≥n y el ejercicio van de la mano:\n\n‚Ä¢ Pre-entreno: Carbos 30-60 min antes\n‚Ä¢ Post-entreno: Prote√≠na + carbos dentro de 2 horas\n‚Ä¢ Hidrataci√≥n antes, durante y despu√©s\n‚Ä¢ No hagas ejercicio en ayuno si eres principiante\n\n¬øQu√© tipo de ejercicio haces y cu√°ndo prefieres entrenar?",
      "Para maximizar tus entrenamientos:\n\n‚Ä¢ Come algo ligero si entrenas en ayunas\n‚Ä¢ Prote√≠na post-entreno para recuperaci√≥n\n‚Ä¢ Carbohidratos para reponer energ√≠a\n‚Ä¢ Electrolitos si sudas mucho\n\n¬øTienes alguna meta espec√≠fica con el ejercicio?"
    ],
  
    // Despedidas amigables
    goodbye: [
      "¬°Fue un placer ayudarte! Espero que pongas en pr√°ctica estos consejos. Recuerda que los cambios peque√±os y consistentes son los que realmente funcionan. ¬°Nos vemos pronto!",
      "¬°Excelente conversaci√≥n! Me da mucho gusto poder apoyarte en tu journey nutricional. Ya sabes que aqu√≠ estar√© cuando necesites m√°s consejos o tengas dudas. ¬°Cu√≠date mucho!",
      "Perfecto, espero haberte ayudado con tus dudas nutricionales. Recuerda ser paciente contigo mismo y celebrar cada progreso. ¬°Que tengas un d√≠a delicioso y nutritivo!",
      "¬°Qu√© bueno poder platicar contigo sobre nutrici√≥n! Aplica lo que conversamos a tu ritmo y sin presi√≥n. Estoy aqu√≠ cuando necesites m√°s apoyo. ¬°Hasta la pr√≥xima!"
    ]
  };
  
  // Sistema de categorizaci√≥n inteligente mejorado
  export const intelligentCategorizer = {
    // Detecta estado emocional en el mensaje
    detectEmotion: (message) => {
      const lowerMessage = message.toLowerCase();
      
      const frustrationWords = ['frustrado', 'frustrada', 'no funciona', 'cansado', 'cansada', 'harto', 'harta', 'desesperado', 'imposible'];
      const motivationWords = ['motivado', 'motivada', 'decidido', 'decidida', 'listo', 'lista', 'empezar', 'comenzar', 'meta'];
      const confusionWords = ['confundido', 'confundida', 'no entiendo', 'no s√©', 'dudas', 'perdido', 'perdida'];
      const anxietyWords = ['preocupado', 'preocupada', 'ansiedad', 'miedo', 'nervioso', 'nerviosa', 'estr√©s'];
      
      if (frustrationWords.some(word => lowerMessage.includes(word))) return 'frustrated';
      if (motivationWords.some(word => lowerMessage.includes(word))) return 'motivated';
      if (confusionWords.some(word => lowerMessage.includes(word))) return 'confused';
      if (anxietyWords.some(word => lowerMessage.includes(word))) return 'anxious';
      
      return null;
    },
  
    // Detecta el tema principal del mensaje
    detectTopic: (message) => {
      const lowerMessage = message.toLowerCase();
      
      // Patrones para p√©rdida de peso
      if (/perder peso|adelgazar|bajar|dieta|quemar grasa|d√©ficit/.test(lowerMessage)) {
        if (/estancado|plateau|no bajo|no pierdo/.test(lowerMessage)) return 'weightLoss.plateaus';
        if (/emocional|ansiedad|estr√©s|sentimientos/.test(lowerMessage)) return 'weightLoss.emotional';
        return 'weightLoss.general';
      }
      
      // Patrones para ganar peso/m√∫sculo
      if (/ganar peso|masa muscular|m√∫sculo|aumentar|bulking/.test(lowerMessage)) {
        if (/cuesta ganar|no gano|dif√≠cil subir|metabolismo r√°pido/.test(lowerMessage)) return 'muscleGain.hardgainer';
        return 'muscleGain.general';
      }
      
      // Patrones para recetas
      if (/receta|cocinar|preparar|comida|plato/.test(lowerMessage)) {
        if (/desayuno|ma√±ana/.test(lowerMessage)) {
          if (/r√°pido|prisa|tiempo/.test(lowerMessage)) return 'recipes.breakfast.quick';
          return 'recipes.breakfast.hearty';
        }
        if (/almuerzo|comida|lunch/.test(lowerMessage)) {
          if (/oficina|trabajo|llevar/.test(lowerMessage)) return 'recipes.lunch.office';
          return 'recipes.lunch.home';
        }
        if (/cena|noche/.test(lowerMessage)) {
          if (/ligero|light|poco/.test(lowerMessage)) return 'recipes.dinner.light';
          return 'recipes.dinner.satisfying';
        }
        if (/snack|merienda|colaci√≥n/.test(lowerMessage)) {
          if (/dulce|antojo|chocolate/.test(lowerMessage)) return 'recipes.snacks.sweet';
          return 'recipes.snacks.savory';
        }
      }
      
      // Otros temas espec√≠ficos
      if (/horario|cu√°ndo|timing|hora/.test(lowerMessage)) {
        if (/trabajo|oficina|turno/.test(lowerMessage)) return 'mealTiming.workSchedule';
        return 'mealTiming.general';
      }
      
      if (/lactosa|l√°cteo|leche/.test(lowerMessage)) return 'intolerances.lactose';
      if (/gluten|cel√≠aco|trigo/.test(lowerMessage)) return 'intolerances.gluten';
      
      if (/agua|hidrat|beber|sed/.test(lowerMessage)) {
        if (/ejercicio|entreno|deporte/.test(lowerMessage)) return 'hydration.exercise';
        return 'hydration.general';
      }
      
      if (/ejercicio|entreno|gym|deporte/.test(lowerMessage)) return 'exercise';
      if (/gracias|bye|adi√≥s|hasta luego/.test(lowerMessage)) return 'goodbye';
      
      return null;
    },
  
    // Funci√≥n principal de categorizaci√≥n
    categorize: (message) => {
      const lowerMessage = message.toLowerCase();
      
      // Saludos
      if (/hola|buenos|buenas|hey|qu√© tal/.test(lowerMessage)) return 'greetings';
      
      // Detectar emoci√≥n primero
      const emotion = this.detectEmotion(message);
      if (emotion) return `emotional.${emotion}`;
      
      // Detectar tema espec√≠fico
      const topic = this.detectTopic(message);
      if (topic) return topic;
      
      // Si no hay coincidencias claras, revisar si parece incoherente
      if (lowerMessage.length < 3 || /^[^a-z√°√©√≠√≥√∫√±]*$/.test(lowerMessage) || 
          lowerMessage.split(' ').length < 2) {
        return 'fallback';
      }
      
      return 'general';
    }
  };
  
  // Funci√≥n mejorada para obtener respuestas
  export const getIntelligentResponse = (message) => {
    const category = intelligentCategorizer.categorize(message);
    const parts = category.split('.');
    
    let responses = nutritionKnowledge;
    for (const part of parts) {
      responses = responses[part];
      if (!responses) break;
    }
    
    if (Array.isArray(responses)) {
      return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // Si no encuentra respuesta espec√≠fica, usa general
    return nutritionKnowledge.general[Math.floor(Math.random() * nutritionKnowledge.general.length)];
  };
  
  // Funciones de utilidad adicionales
  export const getMotivationalMessage = () => {
    return nutritionKnowledge.motivation[Math.floor(Math.random() * nutritionKnowledge.motivation.length)];
  };
  
  export const getRandomRecipe = (mealType = null) => {
    if (mealType && nutritionKnowledge.recipes[mealType]) {
      const mealRecipes = nutritionKnowledge.recipes[mealType];
      const subTypes = Object.keys(mealRecipes);
      const randomSubType = subTypes[Math.floor(Math.random() * subTypes.length)];
      const recipes = mealRecipes[randomSubType];
      return recipes[Math.floor(Math.random() * recipes.length)];
    }
    
    // Receta completamente aleatoria
    const mealTypes = Object.keys(nutritionKnowledge.recipes);
    const randomMealType = mealTypes[Math.floor(Math.random() * mealTypes.length)];
    return getRandomRecipe(randomMealType);
  };
  
  // Sistema de context awareness para conversaciones m√°s naturales
  export const contextManager = {
    lastTopic: null,
    userProfile: {
      goals: [],
      restrictions: [],
      preferences: [],
      challenges: []
    },
    
    updateContext: (message, response) => {
      const category = intelligentCategorizer.categorize(message);
      contextManager.lastTopic = category;
      
      // Detectar informaci√≥n del usuario para personalizar futuras respuestas
      const lowerMessage = message.toLowerCase();
      
      // Detectar objetivos
      if (/perder peso|adelgazar/.test(lowerMessage)) {
        contextManager.userProfile.goals.push('weight_loss');
      }
      if (/ganar peso|masa muscular/.test(lowerMessage)) {
        contextManager.userProfile.goals.push('muscle_gain');
      }
      
      // Detectar restricciones
      if (/lactosa|sin l√°cteos/.test(lowerMessage)) {
        contextManager.userProfile.restrictions.push('lactose_free');
      }
      if (/gluten|cel√≠aco/.test(lowerMessage)) {
        contextManager.userProfile.restrictions.push('gluten_free');
      }
      if (/vegetariano|sin carne/.test(lowerMessage)) {
        contextManager.userProfile.restrictions.push('vegetarian');
      }
      if (/vegano|sin animales/.test(lowerMessage)) {
        contextManager.userProfile.restrictions.push('vegan');
      }
      
      // Detectar desaf√≠os
      if (/tiempo|prisa|r√°pido/.test(lowerMessage)) {
        contextManager.userProfile.challenges.push('time_constraints');
      }
      if (/trabajo|oficina/.test(lowerMessage)) {
        contextManager.userProfile.challenges.push('office_worker');
      }
    },
    
    getPersonalizedResponse: (message) => {
      const baseResponse = getIntelligentResponse(message);
      
      // A√±adir personalizaci√≥n basada en el perfil del usuario
      let personalizedAddition = "";
      
      if (contextManager.userProfile.restrictions.includes('vegetarian')) {
        personalizedAddition += "\n\nPor cierto, recuerda que al ser vegetariano es importante que combines bien las prote√≠nas vegetales.";
      }
      
      if (contextManager.userProfile.challenges.includes('time_constraints')) {
        personalizedAddition += "\n\nComo veo que andas con poco tiempo, te recomiendo meal prep los domingos para toda la semana.";
      }
      
      return baseResponse + personalizedAddition;
    }
  };
  
  // Respuestas adicionales para situaciones espec√≠ficas
  export const specialSituations = {
    // Para cuando el usuario pregunta algo muy espec√≠fico que no est√° cubierto
    specificFood: (food) => {
      return `Sobre ${food} espec√≠ficamente, te puedo decir que es importante considerar su valor nutricional en el contexto de tu dieta completa. ¬øTe gustar√≠a que te ayude a incluirlo en un plan de comidas o tienes alguna duda espec√≠fica sobre este alimento?`;
    },
    
    // Para cuando mencionan una marca espec√≠fica
    brandQuestion: () => {
      return "En cuanto a marcas espec√≠ficas, lo m√°s importante es leer las etiquetas nutricionales y elegir productos con ingredientes simples y sin muchos aditivos. ¬øHay alg√∫n nutriente en particular que est√©s buscando en este producto?";
    },
    
    // Para preguntas m√©dicas que no podemos responder
    medicalDisclaimer: () => {
      return "Esa es una excelente pregunta, pero toca temas m√©dicos espec√≠ficos que est√°n fuera de mi alcance. Te recomiendo consultar con un nutricionista certificado o tu m√©dico para obtener asesor√≠a personalizada y segura. Mientras tanto, ¬øhay algo sobre alimentaci√≥n general en lo que s√≠ te pueda ayudar?";
    },
    
    // Para cuando preguntan sobre suplementos espec√≠ficos
    supplementAdvice: () => {
      return "Los suplementos pueden ser √∫tiles en ciertas situaciones, pero siempre es mejor obtener nutrientes de alimentos integrales cuando sea posible. Para recomendaciones espec√≠ficas de suplementos, te sugiero consultar con un profesional de la salud que pueda evaluar tus necesidades individuales. ¬øTe gustar√≠a que hablemos sobre alimentos ricos en los nutrientes que te interesan?";
    }
  };
  
  // Funciones de detecci√≥n avanzada
  export const advancedDetection = {
    // Detecta si la pregunta es sobre un alimento espec√≠fico
    isAboutSpecificFood: (message) => {
      const foodWords = /\b(pollo|pescado|arroz|pasta|quinoa|avena|huevos|yogur|frutas|verduras|carne|salm√≥n|at√∫n|br√≥coli|espinacas|pl√°tano|manzana|aguacate|almendras)\b/i;
      return foodWords.test(message);
    },
    
    // Detecta si menciona una marca
    mentionsBrand: (message) => {
      // Patrones comunes de marcas o preguntas sobre marcas
      const brandPatterns = /\b(marca|producto|comprar|tienda|s√∫per|supermercado)\b/i;
      return brandPatterns.test(message);
    },
    
    // Detecta preguntas m√©dicas que no debemos responder
    isMedicalQuestion: (message) => {
      const medicalWords = /\b(enfermedad|diabetes|hipertensi√≥n|colesterol|medicamento|tratamiento|s√≠ndrome|condici√≥n m√©dica|doctor|m√©dico)\b/i;
      return medicalWords.test(message);
    },
    
    // Detecta preguntas sobre suplementos espec√≠ficos
    isSupplementQuestion: (message) => {
      const supplementWords = /\b(suplemento|vitamina|mineral|pastilla|c√°psula|prote√≠na en polvo|creatina|omega)\b/i;
      return supplementWords.test(message);
    }
  };
  
  // Funci√≥n principal mejorada que maneja todos los casos
  export const getSmartResponse = (message) => {
    // Actualizar contexto
    contextManager.updateContext(message, null);
    
    // Detecciones especiales
    if (advancedDetection.isMedicalQuestion(message)) {
      return specialSituations.medicalDisclaimer();
    }
    
    if (advancedDetection.isSupplementQuestion(message)) {
      return specialSituations.supplementAdvice();
    }
    
    if (advancedDetection.mentionsBrand(message)) {
      return specialSituations.brandQuestion();
    }
    
    if (advancedDetection.isAboutSpecificFood(message)) {
      const foodMatch = message.match(/\b(pollo|pescado|arroz|pasta|quinoa|avena|huevos|yogur|frutas|verduras|carne|salm√≥n|at√∫n|br√≥coli|espinacas|pl√°tano|manzana|aguacate|almendras)\b/i);
      if (foodMatch) {
        return specialSituations.specificFood(foodMatch[0]);
      }
    }
    
    // Respuesta personalizada normal
    return contextManager.getPersonalizedResponse(message);
  };
  
  // Ejemplos de uso y testing
  export const testCases = {
    examples: [
      {
        input: "Hola, estoy frustrado porque no logro perder peso",
        expectedCategory: "emotional.frustrated",
        description: "Deber√≠a detectar frustraci√≥n y redirigir a respuestas emp√°ticas"
      },
      {
        input: "¬øQu√© puedo desayunar r√°pido antes del trabajo?",
        expectedCategory: "recipes.breakfast.quick",
        description: "Deber√≠a sugerir desayunos r√°pidos"
      },
      {
        input: "asdfgh",
        expectedCategory: "fallback",
        description: "Mensaje incoherente deber√≠a ir a fallback"
      },
      {
        input: "Tengo diabetes y no s√© qu√© comer",
        expectedCategory: "medical",
        description: "Pregunta m√©dica deber√≠a redirigir a profesional"
      }
    ],
    
    runTests: () => {
      console.log("üß™ Ejecutando tests del sistema de respuestas...\n");
      
      testCases.examples.forEach((test, index) => {
        const category = intelligentCategorizer.categorize(test.input);
        const response = getSmartResponse(test.input);
        
        console.log(`Test ${index + 1}: ${test.description}`);
        console.log(`Input: "${test.input}"`);
        console.log(`Categor√≠a detectada: ${category}`);
        console.log(`Respuesta: ${response.substring(0, 100)}...`);
        console.log("---\n");
      });
    }
  };
  
  // Export de todas las funciones principales
  export default {
    getSmartResponse,
    getIntelligentResponse,
    getMotivationalMessage,
    getRandomRecipe,
    intelligentCategorizer,
    contextManager,
    testCases
  };